<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/_css/style.css">
    <link rel="stylesheet" href="/_css/triager.css">
    <title>Triagem de Pacientes</title>
</head>

<body>
    <div class="container">
        <aside class="sidebar">
            <div class="logo">
                <img src="/img/logo-prontosaude.png" alt="Logo ProntoSaúde">
            </div>
            <nav class="sidebar-nav">
                <ul>
                    <li><a href="/triador" class="sidebar-item active"><img
                                src="https://img.icons8.com/ios-filled/50/000000/home.png"
                                alt="Homepage" /><span>Principal</span></a></li>
                    <li><a href="/fila" class="sidebar-item"><img
                                src="https://img.icons8.com/ios-filled/50/ffffff/user-group-man-man.png"
                                alt="View Queue" /><span>Fila</span></a></li>
                    <li><a href="#" class="sidebar-item"><img
                                src="https://img.icons8.com/ios-filled/50/ffffff/bar-chart.png"
                                alt="Statistics" /><span>Estatísticas</span></a></li>
                </ul>
            </nav>
        </aside>

        <main class="main-content">
            <header class="header">
                <div class="user-info">
                    <div class="user-avatar">
                        <img src="https://img.icons8.com/ios-filled/20/ffffff/user-male-circle.png" alt="User" />
                    </div>
                    <div>
                        <div class="user-name" id="loggedInUserName"></div>
                        <div class="user-role" id="loggedInUserRole"></div>
                    </div>
                </div>
            </header>

            <section id="triage-queue-list">
                <h1 class="page-title">Pacientes para Triagem</h1>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>NOME</th>
                            <th>CPF</th>
                            <th>CARTÃO SUS</th>
                            <th>TELEFONE</th>
                            <th>DATA DE NASCIMENTO</th>
                            <th>AÇÃO</th>
                        </tr>
                    </thead>
                    <tbody id="triage-queue-body">
                    </tbody>
                </table>
            </section>

            <section id="triage-data-form" style="display: none;">
                <h1 class="page-title">Dados da Triagem</h1>

                <div class="patient-info-display">
                    <h2 id="display-patient-name"></h2>
                    <p id="display-patient-dob"></p>
                </div>

                <form class="triage-form" id="triage-form-element">
                    <input type="hidden" id="patient_id" name="patient_id">
                    <input type="hidden" id="service_id" name="service_id">

                    <div class="form-row">
                        <div class="form-group">
                            <label for="blood_pressure">Pressão Arterial</label>
                            <input type="text" id="blood_pressure" name="blood_pressure" placeholder="Ex: 120/80"
                                required>
                        </div>
                        <div class="form-group">
                            <label for="temperature">Temperatura (°C)</label>
                            <input type="number" step="0.1" id="temperature" name="temperature" placeholder="Ex: 36.5"
                                required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="glucose">Glicose (mg/dL)</label>
                            <input type="number" id="glucose" name="glucose" placeholder="Ex: 90" required>
                        </div>
                        <div class="form-group">
                            <label for="weight">Peso (kg)</label>
                            <input type="number" step="0.1" id="weight" name="weight" placeholder="Ex: 70.5" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="oxygen_saturation">Saturação de Oxigênio (%)</label>
                            <input type="number" id="oxygen_saturation" name="oxygen_saturation" placeholder="Ex: 98"
                                required>
                        </div>
                        <div class="form-group">
                            <label for="priority_classification">Classificação de Prioridade</label>
                            <div class="select-wrapper">
                                <select id="priority_classification" name="classification_id" required>
                                    <option value="" disabled selected>Carregando...</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="form-group full-width">
                        <label for="symptoms">Sintomas e Observações</label>
                        <textarea id="symptoms" name="symptoms" rows="5"
                            placeholder="Descreva os sintomas e observações relevantes" required></textarea>
                    </div>

                    <div class="form-buttons">
                        <button type="submit" class="submit-button">Registrar Triagem</button>
                        <button type="button" class="back-button">Voltar para a Lista</button>
                    </div>
                </form>
            </section>
        </main>
    </div>

    <script src="/_js/triager.js"></script>
<script>
        document.addEventListener('DOMContentLoaded', () => {
            const userNameElement = document.getElementById('loggedInUserName');
            const userRoleElement = document.getElementById('loggedInUserRole');

            const userDataString = sessionStorage.getItem('loggedInUser');

            if (userDataString) {
                try {
                    const userData = JSON.parse(userDataString);
                    if (userNameElement) {
                        userNameElement.textContent = userData.username;
                    }
                    if (userRoleElement) {
                        userRoleElement.textContent = userData.role;
                    }
                } catch (e) {
                    console.error('Erro ao fazer parse dos dados do usuário do sessionStorage:', e);
                    sessionStorage.removeItem('loggedInUser');
                }
            } else {
                console.warn('Nenhum dado de usuário encontrado no sessionStorage para o triador.');
                if (userNameElement) userNameElement.textContent = 'Visitante';
                if (userRoleElement) userRoleElement.textContent = 'Desconhecido';
                // Opcional: Redirecionar para o login se o usuário não estiver logado
                // if (!window.location.pathname.includes('/login')) {
                //     window.location.href = '/';
                // }
            }
        });
    </script>

</body>

</html>